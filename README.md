# üé® Toulouse Lautrec Design System

Sistema de dise√±o modular basado en **Lit Components** y **Design Tokens**, con generaci√≥n autom√°tica de temas WordPress.

## üìã Tabla de Contenidos

- [üèóÔ∏è Arquitectura](#Ô∏è-arquitectura)
- [üöÄ Inicio R√°pido](#-inicio-r√°pido)
- [üß© Componentes](#-componentes)
- [üéØ Design Tokens](#-design-tokens)
- [‚öôÔ∏è Configuraci√≥n](#Ô∏è-configuraci√≥n)
- [üîß Generaci√≥n WordPress](#-generaci√≥n-wordpress)
- [üìö Documentaci√≥n](#-documentaci√≥n)
- [üõ†Ô∏è Desarrollo](#Ô∏è-desarrollo)
- [üì¶ Despliegue](#-despliegue)

## üèóÔ∏è Arquitectura

### Estructura del Proyecto

```
toulouse-design-system/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/           # Componentes Lit
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hero-section/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ course-card/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ testimonials/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ feature-grid/
‚îÇ   ‚îú‚îÄ‚îÄ tokens/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ design-tokens.css # Variables CSS centralizadas
‚îÇ   ‚îú‚îÄ‚îÄ component-metadata.json # Configuraci√≥n completa del sistema
‚îÇ   ‚îú‚îÄ‚îÄ page-templates.json   # Configuraci√≥n de p√°ginas
‚îÇ   ‚îî‚îÄ‚îÄ index.js             # Entry point
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ storybook/              # Herramientas de Storybook
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generate-stories-robust.js  # Generador robusto con mocks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generate-stories.js         # Generador b√°sico
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test-story-generator.js     # Testing del generador
‚îÇ   ‚îú‚îÄ‚îÄ config/                 # Configuraci√≥n y builds
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ generate-wp-templates.js    # Generador principal
‚îÇ   ‚îú‚îÄ‚îÄ validation/             # Validaci√≥n y testing
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validate-wp-theme.js        # Validador de temas
‚îÇ   ‚îî‚îÄ‚îÄ wp-generator/           # Generador WordPress (Reorganizado)
‚îÇ       ‚îú‚îÄ‚îÄ core/               # Archivos principales
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ config.js              # Configuraci√≥n central con Analytics
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.js               # Entry point principal
‚îÇ       ‚îú‚îÄ‚îÄ managers/           # Gestores especializados
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ asset-manager.js       # Gesti√≥n de assets
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ analytics-manager.js   # **NUEVO** - Analytics separado de SEO
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ seo-manager.js         # SEO din√°mico puro
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ config-manager.js      # Configuraci√≥n din√°mica
‚îÇ       ‚îú‚îÄ‚îÄ validation/         # Sistema de validaci√≥n
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ validation-manager.js  # Validaciones avanzadas
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ php-validator.js       # Validaci√≥n PHP en tiempo real
‚îÇ       ‚îú‚îÄ‚îÄ templates/          # Sistema de templates
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ component-generator.js # Conversi√≥n Lit ‚Üí PHP
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ template-builder.js    # Plantillas WordPress
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ php-components.js      # Generador PHP components
‚îÇ       ‚îú‚îÄ‚îÄ extensions/         # **NUEVO** - Sistema de extensiones
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ extension-manager.js   # Gestor de extensiones
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ analytics/             # Extensiones de Analytics
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ ga4-data-layer.js      # Google Analytics 4 Data Layer
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ facebook-pixel.js      # Facebook Pixel integration
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ custom-events.js       # Eventos personalizados
‚îÇ       ‚îî‚îÄ‚îÄ legacy/             # Archivos legacy (deprecados)
‚îú‚îÄ‚îÄ dist/                    # Build de Vite
‚îú‚îÄ‚îÄ wordpress-output/        # Tema WordPress generado
‚îî‚îÄ‚îÄ storybook-static/        # Documentaci√≥n
```

### Flujo de Trabajo

```mermaid
graph LR
    A[Componente Lit] --> B[Metadata JSON]
    B --> C[Generador]
    C --> D[PHP + WordPress]
    A --> E[Storybook]
    E --> F[Documentaci√≥n]
```

## üöÄ Inicio R√°pido

### Prerrequisitos

- Node.js 24+ (recomendado)
- npm o yarn

### Instalaci√≥n

```bash
# Clonar el repositorio
git clone <repository-url>
cd toulouse-design-system

# Instalar dependencias
npm install

# Iniciar desarrollo
npm run dev

# Abrir Storybook
npm run storybook
```

### Comandos Disponibles

```bash
# Desarrollo
npm run dev              # Servidor de desarrollo Vite
npm run build            # Build de producci√≥n
npm run storybook        # Documentaci√≥n interactiva
npm run build-storybook  # Build de Storybook

# WordPress
npm run wp:generate      # Generar tema WordPress completo
npm run wp:validate      # Validar tema generado
npm run wp:validate-php  # Validar sintaxis PHP interactiva
npm run wp:test-urls     # Probar URLs del tema WordPress

# Stories (ACTUALIZADO)
npm run stories:generate        # Generador b√°sico (legacy)
npm run stories:generate:robust # Generador robusto (recomendado) 
npm run stories:test            # Testing del generador
```

## üß© Componentes

### Tipos de Componentes

El sistema soporta tres tipos de componentes con diferentes comportamientos:

#### 1. **Static** - Props Fijos
```javascript
// Lit Component
export class HeroSection extends LitElement {
  static properties = {
    title: { type: String },
    subtitle: { type: String }
  };
}
```

```json
// Metadata
{
  "hero-section": {
    "type": "static",
    "phpFunction": "render_hero_section",
    "parameters": [
      { "name": "title", "type": "string", "default": "" },
      { "name": "subtitle", "type": "string", "default": "" }
    ]
  }
}
```

#### 2. **Iterative** - Renderizado por Item
```javascript
// Lit Component
export class CourseCard extends LitElement {
  static properties = {
    title: { type: String },
    description: { type: String }
  };
}
```

```json
// Metadata
{
  "course-card": {
    "type": "iterative",
    "phpFunction": "render_course_card",
    "iteration": {
      "mode": "individual",
      "renderPerItem": true
    }
  }
}
```

#### 3. **Aggregated** - Datos Agregados
```javascript
// Lit Component
export class Testimonials extends LitElement {
  static properties = {
    testimonials: { type: Array }
  };
}
```

```json
// Metadata
{
  "testimonials": {
    "type": "aggregated",
    "phpFunction": "render_testimonials",
    "aggregation": {
      "mode": "collect",
      "dataStructure": {
        "name": "post_title",
        "content": "post_content"
      }
    }
  }
}
```

### Crear un Nuevo Componente

1. **Crear estructura de archivos:**
```bash
mkdir src/components/mi-componente
touch src/components/mi-componente/mi-componente.js
touch src/components/mi-componente/mi-componente.stories.js
```

2. **Implementar componente Lit:**
```javascript
import { LitElement, html, css } from 'lit';

export class MiComponente extends LitElement {
  static properties = {
    title: { type: String },
    items: { type: Array }
  };

  static styles = css`
    :host {
      display: block;
    }
    /* Estilos usando design tokens */
    .container {
      padding: var(--tl-spacing-8);
      background: var(--tl-neutral-50);
    }
  `;

  render() {
    return html`
      <div class="container">
        <h2>${this.title}</h2>
        ${this.items?.map(item => html`
          <div class="item">${item.name}</div>
        `)}
      </div>
    `;
  }
}

customElements.define('tl-mi-componente', MiComponente);
```

3. **Crear Storybook story:**
```javascript
import { html } from 'lit';
import '../design-system.stories.js';
import { MiComponente } from './mi-componente.js';

export default {
  title: 'Components/MiComponente',
  component: 'tl-mi-componente',
  argTypes: {
    title: { control: 'text' },
    items: { control: 'object' }
  }
};

const Template = (args) => html`
  <tl-mi-componente
    .title=${args.title}
    .items=${args.items}
  ></tl-mi-componente>
`;

export const Default = Template.bind({});
Default.args = {
  title: 'Mi Componente',
  items: [
    { name: 'Item 1' },
    { name: 'Item 2' }
  ]
};
```

4. **Agregar metadata en `component-metadata.json`:**
```json
{
  "mi-componente": {
    "type": "aggregated",
    "phpFunction": "render_mi_componente",
    "parameters": [
      { "name": "title", "type": "string", "default": "" },
      { "name": "items", "type": "array", "default": "[]" }
    ],
    "aggregation": {
      "mode": "collect",
      "dataStructure": {
        "name": "post_title",
        "description": "post_content"
      }
    }
  }
}
```

5. **Exportar en `src/index.js`:**
```javascript
import './components/mi-componente/mi-componente.js';
export { MiComponente } from './components/mi-componente/mi-componente.js';
```

## üéØ Design Tokens

### Variables CSS Centralizadas

Los design tokens est√°n definidos en `src/tokens/design-tokens.css`:

```css
:root {
  /* Colores */
  --tl-primary-50: #eff6ff;
  --tl-primary-500: #3b82f6;
  --tl-primary-900: #1e3a8a;
  
  /* Tipograf√≠as */
  --tl-font-primary: 'Nunito Sans', sans-serif;
  --tl-font-size-sm: 0.875rem;
  --tl-font-size-base: 1rem;
  --tl-font-size-lg: 1.125rem;
  --tl-font-size-xl: 1.25rem;
  --tl-font-size-2xl: 1.5rem;
  --tl-font-size-3xl: 1.875rem;
  
  /* Espaciados */
  --tl-spacing-1: 0.25rem;
  --tl-spacing-2: 0.5rem;
  --tl-spacing-4: 1rem;
  --tl-spacing-6: 1.5rem;
  --tl-spacing-8: 2rem;
  --tl-spacing-12: 3rem;
  --tl-spacing-16: 4rem;
  
  /* Sombras */
  --tl-shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --tl-shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  --tl-shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
  
  /* Transiciones */
  --tl-transition-normal: all 0.3s ease;
}
```

### Uso en Componentes

```javascript
static styles = css`
  .button {
    background: var(--tl-primary-500);
    padding: var(--tl-spacing-4) var(--tl-spacing-6);
    font-family: var(--tl-font-primary);
    font-size: var(--tl-font-size-base);
    border-radius: var(--tl-spacing-2);
    transition: var(--tl-transition-normal);
  }
`;
```

## ‚öôÔ∏è Configuraci√≥n

### Configuraci√≥n Central (`scripts/wp-generator/core/config.js`)

Configuraci√≥n centralizada del sistema con Analytics integrado:

```javascript
export const config = {
  theme: {
    name: 'toulouse-lautrec',
    displayName: 'Toulouse Lautrec - Design System',
    description: 'Sistema de dise√±o modular basado en componentes Lit',
    version: '1.0.0',
    author: 'Toulouse Lautrec'
  },
  
  // **NUEVO** - Configuraci√≥n de Analytics separada de SEO
  analytics: {
    enabled: true,
    googleAnalytics: {
      measurementId: 'G-XXXXXXXXXX', // Configurar GA4 ID
      enabled: true,
      enhancedEcommerce: true,
      dataLayer: {
        courseViews: true,
        testimonialViews: true,
        ctaClicks: true
      }
    },
    facebookPixel: {
      pixelId: '', // Configurar Facebook Pixel ID
      enabled: false
    },
    customEvents: {
      pageViews: true,
      componentViews: true,
      interactions: true,
      performanceTracking: true // Web vitals (LCP, FID, CLS)
    }
  },
  
  seo: {
    siteName: 'Toulouse Lautrec',
    siteDescription: 'Instituci√≥n educativa especializada en dise√±o, tecnolog√≠a y creatividad',
    author: 'Toulouse Lautrec',
    twitterCard: 'summary_large_image'
  },
  
  wordpress: {
    outputDir: './wordpress-output',
    assetsDir: './dist',
    validation: {
      enabled: true,
      phpSyntax: true,
      failFast: true
    }
  }
};
```

### Configuraci√≥n de Performance (component-metadata.json)

Cada componente puede tener configuraci√≥n espec√≠fica de performance:

```json
{
  "course-card": {
    "type": "iterative",
    "phpFunction": "render_course_card",
    "performance": {
      "lazyLoading": true,        // **NUEVO** - Lazy loading configurado
      "preloadImages": false,     // No precarga im√°genes
      "deferScript": true         // Defer JavaScript loading
    },
    "analytics": {
      "trackViews": true,          // **NUEVO** - Tracking de vistas
      "trackClicks": true,        // Tracking de clicks
      "category": "course_engagement"
    }
  },
  "hero-section": {
    "type": "static",
    "phpFunction": "render_hero_section", 
    "performance": {
      "lazyLoading": false,       // No lazy loading para hero
      "preloadImages": true,      // Precarga im√°genes cr√≠ticas
      "criticalCSS": true         // CSS cr√≠tico inline
    },
    "analytics": {
      "trackViews": true,
      "trackCTAs": true,          // Tracking espec√≠fico de CTAs
      "category": "hero_engagement"
    }
  }
}
```

### Configuraci√≥n de P√°ginas (`page-templates.json`)

Define la estructura de p√°ginas WordPress con componentes:

```json
{
  "page-carreras": {
    "title": "Carreras",
    "description": "Explora nuestras carreras t√©cnicas",
    "components": [
      {
        "name": "hero-section",
        "props": {
          "title": "Nuestras Carreras",
          "subtitle": "Descubre tu potencial creativo"
        },
        "seo": {
          "title": "Carreras | Toulouse Lautrec",
          "description": "Explora nuestras carreras t√©cnicas",
          "keywords": "carreras, dise√±o, tecnolog√≠a"
        },
        "analytics": {
          "pageView": "page_view_carreras",
          "events": [
            {
              "name": "hero_cta_click",
              "category": "engagement",
              "action": "click"
            }
          ]
        }
      },
      {
        "name": "course-card",
        "dataSource": {
          "type": "wordpress_posts",
          "postType": "carrera",
          "query": {
            "numberposts": -1,
            "post_status": "publish"
          }
        }
      }
    ]
  }
}
```

### Configuraci√≥n del Sistema (`component-metadata.json`)

Define la configuraci√≥n completa del sistema:

```json
{
  "postTypes": {
    "carrera": {
      "labels": {
        "name": "Carreras",
        "singular_name": "Carrera"
      },
      "public": true,
      "supports": ["title", "editor", "thumbnail", "excerpt"]
    },
    "testimonio": {
      "labels": {
        "name": "Testimonios", 
        "singular_name": "Testimonio"
      },
      "public": true,
      "supports": ["title", "editor", "thumbnail", "excerpt"],
      "show_in_rest": true
    }
  },
  "templates": {
    "page-carreras": {
      "file": "page-carreras.php",
      "title": "Carreras",
      "description": "Explora nuestras carreras t√©cnicas"
    }
  },
  "componentMapping": {
    "course-card": "carrera",
    "testimonials": "testimonio"
  },
  "hero-section": {
    "type": "static",
    "phpFunction": "render_hero_section",
    "parameters": [
      {
        "name": "title",
        "type": "string", 
        "default": ""
      }
    ]
  }
}
```

## üîß Generaci√≥n WordPress

### Proceso de Generaci√≥n

1. **Limpieza**: Elimina completamente el directorio de salida anterior
2. **Configuraci√≥n**: Detecta configuraci√≥n din√°mica del proyecto (ConfigManager)
3. **Estructura**: Crea la estructura del tema WordPress
4. **Conversi√≥n**: Convierte componentes Lit a PHP con manejo avanzado de templates
5. **Assets**: Construye con Vite y optimiza CSS/JS 
6. **Templates**: Genera plantillas de p√°gina con SEO din√°mico
7. **Validaci√≥n Completa**: Verifica integridad y sintaxis PHP en tiempo real
8. **SEO**: Genera meta tags y JSON-LD espec√≠ficos por template
9. **Reporte**: Genera reportes de validaci√≥n detallados con estad√≠sticas

### Estructura del Tema Generado

```
wordpress-output/toulouse-lautrec/
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ design-tokens.css
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ toulouse-design-system-[hash].css
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ toulouse-ds.es.js          # ES6 modules (preferido)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ toulouse-ds.umd.js         # UMD fallback
‚îÇ   ‚îú‚îÄ‚îÄ seo-config.json                # Configuraci√≥n SEO por template
‚îÇ   ‚îú‚îÄ‚îÄ asset-manifest.json            # Manifest de assets con hashes
‚îÇ   ‚îî‚îÄ‚îÄ validation-rules.json          # Reglas de validaci√≥n
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ hero-section/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hero-section.php
‚îÇ   ‚îú‚îÄ‚îÄ course-card/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ course-card.php
‚îÇ   ‚îî‚îÄ‚îÄ testimonials/
‚îÇ       ‚îî‚îÄ‚îÄ testimonials.php          # Con conversi√≥n Lit ‚Üí PHP
‚îú‚îÄ‚îÄ inc/
‚îÇ   ‚îú‚îÄ‚îÄ seo-manager.php               # SEO din√°mico puro (sin Analytics)
‚îÇ   ‚îú‚îÄ‚îÄ analytics-manager.php         # **NUEVO** - Analytics separado
‚îÇ   ‚îú‚îÄ‚îÄ validation.php                # Sistema de validaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ asset-enqueue.php             # Carga optimizada de assets
‚îú‚îÄ‚îÄ functions.php                     # Con configuraci√≥n din√°mica
‚îú‚îÄ‚îÄ index.php
‚îú‚îÄ‚îÄ front-page.php
‚îú‚îÄ‚îÄ page-carreras.php                 # Con SEO espec√≠fico
‚îî‚îÄ‚îÄ style.css
```

### üÜï Conversi√≥n Avanzada Lit ‚Üí PHP

El sistema incluye conversi√≥n autom√°tica de templates Lit a PHP con manejo inteligente de:

#### ‚úÖ M√©todos JavaScript
```javascript
// Lit Component
renderStars(rating) {
  const stars = [];
  for (let i = 1; i <= 5; i++) {
    stars.push(html`<span class="star">${i <= rating ? '‚òÖ' : '‚òÜ'}</span>`);
  }
  return stars;
}

render() {
  return html`
    <div class="rating">
      ${this.renderStars(testimonial.rating)}
    </div>
  `;
}
```

```php
<!-- PHP Generado Autom√°ticamente -->
<div class="rating">
  <?php for ($i = 1; $i <= 5; $i++): ?>
    <span class="star"><?php echo $i <= $item['rating'] ? '‚òÖ' : '‚òÜ'; ?></span>
  <?php endfor; ?>
</div>
```

#### ‚úÖ Condicionales Complejos
```javascript
// Lit Component
${testimonial.avatar ? html`
  <img src="${testimonial.avatar}" alt="${testimonial.name}" class="author-avatar" />
` : html`
  <div class="author-avatar" style="background: var(--tl-primary-500);">
    ${testimonial.name.charAt(0).toUpperCase()}
  </div>
`}
```

```php
<!-- PHP Generado Autom√°ticamente -->
<?php if (!empty($item['avatar'])): ?>
  <img src="<?php echo esc_url($item['avatar']); ?>" alt="<?php echo esc_attr($item['name']); ?>" class="author-avatar" />
<?php else: ?>
  <div class="author-avatar" style="background: var(--tl-primary-500); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
    <?php echo esc_html(strtoupper(substr($item['name'], 0, 1))); ?>
  </div>
<?php endif; ?>
```

#### ‚úÖ Arrays y Loops
```javascript
// Lit Component
${this.testimonials.map(testimonial => html`
  <div class="testimonial-card">
    <p class="testimonial-content">"${testimonial.content}"</p>
    <div class="author-name">${testimonial.name}</div>
  </div>
`)}
```

```php
<!-- PHP Generado Autom√°ticamente -->
<?php if (!empty($testimonials)): ?>
  <?php foreach ($testimonials as $item): ?>
    <div class="testimonial-card">
      <p class="testimonial-content">"<?php echo esc_html($item['content']); ?>"</p>
      <div class="author-name"><?php echo esc_html($item['name']); ?></div>
    </div>
  <?php endforeach; ?>
<?php else: ?>
  <p>No hay elementos disponibles.</p>
<?php endif; ?>
```

### Custom Post Types

El sistema registra autom√°ticamente CPTs basados en la metadata:

```php
// functions.php - Generado autom√°ticamente desde component-metadata.json
function toulouse_register_post_types() {
    // Carreras
    register_post_type('carrera', array(
        'labels' => array(
            'name' => 'Carreras',
            'singular_name' => 'Carrera'
        ),
        'public' => true,
        'supports' => array('title', 'editor', 'thumbnail', 'excerpt'),
    ));
    
    // Testimonios  
    register_post_type('testimonio', array(
        'labels' => array(
            'name' => 'Testimonios',
            'singular_name' => 'Testimonio'
        ),
        'public' => true,
        'supports' => array('title', 'editor', 'thumbnail', 'excerpt'),
        'show_in_rest' => true,
    ));
}
add_action('init', 'toulouse_register_post_types');
```

### üÜï SEO Din√°mico y Analytics Manager Separado

El sistema incluye **SEO Manager** y **Analytics Manager** como sistemas independientes con responsabilidades espec√≠ficas:

#### üìä Analytics Manager (Nuevo)
- **Google Analytics 4** configurado desde `config.js`
- **Extensiones modulares** para diferentes plataformas (GA4, Facebook, Custom Events)
- **Data Layer mapping** avanzado para medici√≥n educativa
- **Performance tracking** y eventos de conversi√≥n
- **Lazy loading** configurado desde component metadata

#### üîç SEO Manager (Refactorizado)
- **Responsabilidad √∫nica**: Meta tags y structured data
- **SEO din√°mico** puro sin l√≥gica de Analytics
- **JSON-LD estructurado** por template
- **Meta tags espec√≠ficos** por p√°gina

#### ‚úÖ Meta Tags Din√°micos por Template
```json
// assets/seo-config.json (generado autom√°ticamente)
{
  "templates": {
    "page-carreras": {
      "title": "Carreras T√©cnicas | Toulouse Lautrec",
      "description": "Explora nuestras carreras t√©cnicas y programas especializados en dise√±o, tecnolog√≠a y creatividad.",
      "keywords": "carreras t√©cnicas, dise√±o, tecnolog√≠a, creatividad, Toulouse Lautrec",
      "ogType": "website",
      "schema": {
        "type": "Course",
        "provider": {
          "type": "Organization", 
          "name": "Toulouse Lautrec"
        }
      }
    }
  }
}
```

#### ‚úÖ Meta Tags HTML Generados
```html
<!-- HTML generado autom√°ticamente en <head> -->
<meta name="description" content="Explora nuestras carreras t√©cnicas y programas especializados en dise√±o, tecnolog√≠a y creatividad.">
<meta name="keywords" content="carreras t√©cnicas, dise√±o, tecnolog√≠a, creatividad, Toulouse Lautrec">
<meta property="og:title" content="Carreras T√©cnicas | Toulouse Lautrec">
<meta property="og:description" content="Explora nuestras carreras t√©cnicas y programas especializados en dise√±o, tecnolog√≠a y creatividad.">
<meta property="og:type" content="website">
<meta property="og:url" content="http://localhost/carreras/">
<meta name="twitter:card" content="summary_large_image">
<link rel="canonical" href="http://localhost/carreras/">
```

#### ‚úÖ JSON-LD Estructurado
```html
<!-- Script JSON-LD generado autom√°ticamente -->
<script type="application/ld+json">
[
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Toulouse Lautrec",
    "url": "http://localhost",
    "description": "Instituci√≥n educativa especializada en dise√±o, tecnolog√≠a y creatividad"
  },
  {
    "@context": "https://schema.org", 
    "@type": "Course",
    "name": "Nuestras Carreras",
    "description": "Descubre tu potencial creativo con nuestras carreras t√©cnicas",
    "provider": {
      "type": "Organization",
      "name": "Toulouse Lautrec"
    }
  }
]
</script>
```

#### ‚úÖ Analytics Manager - GA4 Integration
```php
// inc/analytics-manager.php - Analytics separado
class AnalyticsManager {
    private $config;
    
    public function __construct($analytics_config) {
        $this->config = $analytics_config;
    }
    
    public function generateGA4Script() {
        if (!$this->config['googleAnalytics']['enabled']) {
            return '';
        }
        
        $measurement_id = $this->config['googleAnalytics']['measurementId'];
        $script = '<script async src="https://www.googletagmanager.com/gtag/js?id=' . $measurement_id . '"></script>';
        $script .= '<script>';
        $script .= 'window.dataLayer = window.dataLayer || [];';
        $script .= 'function gtag(){dataLayer.push(arguments);}';
        $script .= 'gtag("js", new Date());';
        $script .= 'gtag("config", "' . $measurement_id . '", {';
        $script .= '  enhanced_ecommerce: true,';
        $script .= '  track_page_view: true';
        $script .= '});';
        $script .= '</script>';
        
        return $script;
    }
    
    public function generateDataLayer() {
        // Extensiones de Data Layer desde extensions/analytics/
        return $this->loadAnalyticsExtensions();
    }
}
```

#### ‚úÖ Extensiones de Analytics
```javascript
// extensions/analytics/ga4-data-layer.js
const GA4DataLayer = {
    // Eventos educativos espec√≠ficos
    trackCourseView: (courseData) => {
        gtag('event', 'course_view', {
            event_category: 'education',
            course_name: courseData.title,
            course_category: courseData.category,
            custom_parameter_1: 'toulouse_lautrec'
        });
    },
    
    trackTestimonialInteraction: (testimonialData) => {
        gtag('event', 'testimonial_engagement', {
            event_category: 'social_proof',
            testimonial_author: testimonialData.name,
            testimonial_course: testimonialData.course
        });
    },
    
    // Performance tracking
    trackWebVitals: () => {
        // LCP, FID, CLS tracking autom√°tico
        new PerformanceObserver((list) => {
            for (const entry of list.getEntries()) {
                gtag('event', 'web_vitals', {
                    event_category: 'performance',
                    metric_name: entry.entryType,
                    metric_value: Math.round(entry.startTime)
                });
            }
        }).observe({entryTypes: ['largest-contentful-paint', 'first-input', 'cumulative-layout-shift']});
    }
};
```

#### ‚úÖ Configuraci√≥n sin Hardcoding
```javascript
// Antes (Hardcoded)
if (componentName !== 'hero-section') {
    // Lazy loading hardcoded
}

// Despu√©s (Metadata-driven)
const componentMetadata = getComponentMetadata(componentName);
if (componentMetadata?.performance?.lazyLoading) {
    // Lazy loading configurado desde metadata
}
```

#### ‚úÖ Detecci√≥n Autom√°tica de Templates
```php
// inc/seo-manager.php - Detecci√≥n inteligente
private function getCurrentTemplateSlug() {
    global $template;
    
    // Detecta autom√°ticamente el template actual
    if ($template) {
        return basename($template, '.php'); // page-carreras
    }
    
    // M√∫ltiples fallbacks para m√°xima compatibilidad
    $template_slug = get_page_template_slug();
    if ($template_slug) {
        return basename($template_slug, '.php');
    }
    
    return '';
}
```

### üîí Validaci√≥n Autom√°tica de Sintaxis PHP

El sistema incluye validaci√≥n autom√°tica de sintaxis PHP para prevenir errores en WordPress:

#### üîç Validaci√≥n Durante Generaci√≥n

```bash
npm run wp:generate
```

**üÜï Caracter√≠sticas Avanzadas:**
- ‚úÖ **Validaci√≥n en tiempo real** con `php -l` al escribir cada archivo PHP
- ‚úÖ **Pre-validaci√≥n de patrones problem√°ticos** antes del CLI de PHP
- ‚úÖ **Rollback autom√°tico completo** si se detectan errores
- ‚úÖ **100% de archivos validados** antes del despliegue
- ‚úÖ **Detecci√≥n temprana** de errores de sintaxis y runtime  
- ‚úÖ **Reportes detallados** con l√≠neas espec√≠ficas de error
- ‚úÖ **Prevenci√≥n de deployment** con errores
- ‚úÖ **Detecci√≥n de null pointers** en variables globales
- ‚úÖ **Protecci√≥n contra errores runtime** comunes
- ‚úÖ **Limpieza CSS mejorada** (remoci√≥n de `:host` y Web Components)
- ‚úÖ **Detecci√≥n de conflictos JavaScript/PHP** en templates
- ‚úÖ **Conversi√≥n autom√°tica Lit ‚Üí PHP** con manejo de m√©todos y condicionales
- ‚úÖ **SEO din√°mico** con meta tags espec√≠ficos por template
- ‚úÖ **Configuraci√≥n client-agnostic** usando ConfigManager

#### üõ†Ô∏è Validaci√≥n Interactiva

```bash
npm run wp:validate-php
```

**Salida ejemplo:**
```
üîç Iniciando validaci√≥n completa de sintaxis PHP...
üêò PHP detectado: PHP 8.4.4 (cli)
üìã Validando archivos principales...
üìÑ Validando templates de p√°gina...
üß© Validando componentes...

üìä Reporte de Validaci√≥n PHP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìÅ Archivos totales: 19
‚úÖ Archivos v√°lidos: 19
‚ùå Errores encontrados: 0
üìà Tasa de √©xito: 100.0%

üéâ ¬°Todos los archivos PHP tienen sintaxis correcta!
```

#### üö® Patrones de Error Detectados

**1. JavaScript en contexto PHP:**
```php
// ‚ùå Problem√°tico - Puede confundir IDEs
?>
<script>
// gtag('config', 'GA_ID', { ... });  // "config" causa error
</script>
<?php

// ‚úÖ Solucionado autom√°ticamente
echo '<script>';
echo 'gtag("config", "GA_ID", { });';  // Encapsulado en echo
echo '</script>';
```

**2. Web Components CSS en WordPress:**
```css
/* ‚ùå CSS de Lit Components - No v√°lido en WordPress */
:host {
  display: block;
}
.component {
  /* Sin llaves de cierre */
/* ‚úÖ CSS limpio autom√°ticamente */
.component-section {
  display: block;
}
```

**3. Variables globales sin validaci√≥n:**
```php
// ‚ùå Peligroso - Null pointer
global $toulouse_seo;
echo $toulouse_seo->generateMetaTags();

// ‚úÖ Seguro - Validado autom√°ticamente  
global $toulouse_seo;
if ($toulouse_seo && method_exists($toulouse_seo, 'generateMetaTags')) {
    echo $toulouse_seo->generateMetaTags();
}
```

#### ‚ùå Manejo de Errores

Si se detectan errores:
```
‚ùå Errores de Sintaxis PHP:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üìÑ functions.php
   ‚îî‚îÄ L√≠nea 181: syntax error, unexpected identifier "config"
   ‚îî‚îÄ Soluci√≥n: JavaScript keywords en contexto PHP detectado

üìÑ seo-manager.php  
   ‚îî‚îÄ L√≠nea 273: Uso de variable global $toulouse_seo sin verificar si existe (posible null pointer)
   ‚îî‚îÄ Soluci√≥n: Usar if ($var && method_exists($var, 'method'))

üìÑ feature-grid.php
   ‚îî‚îÄ CSS estructura malformada: selector sin llaves de cierre
   ‚îî‚îÄ Soluci√≥n: Aplicada limpieza autom√°tica de CSS

üßπ Rollback completado. No se dejaron archivos con errores.

üí° Consejos para corregir errores:
   ‚Ä¢ JavaScript keywords ‚Üí Usar echo para encapsular JS
   ‚Ä¢ Variables globales ‚Üí Validar con isset() y method_exists() 
   ‚Ä¢ CSS Web Components ‚Üí Limpieza autom√°tica aplicada
   ‚Ä¢ Comillas no balanceadas ‚Üí Verificar strings en echo statements
```

#### üìã Prerrequisitos

- **PHP CLI** instalado en el sistema
- Versi√≥n recomendada: **PHP 8.0+**
- Compatible con PHP 7.4+ 

## üìö Documentaci√≥n

### Storybook

La documentaci√≥n interactiva est√° disponible en:

```bash
npm run storybook
```

Accede a: `http://localhost:6006`

### Estructura de Documentaci√≥n

- **Design Tokens**: Colores, tipograf√≠as, espaciados
- **Componentes**: Cada componente con sus variantes
- **üÜï Mocks Personalizados**: Datos espec√≠ficos del dominio para cada componente
- **P√°ginas**: Ejemplos de p√°ginas completas
- **Gu√≠as**: Patrones de uso y mejores pr√°cticas

### Generaci√≥n Autom√°tica de Stories

Los stories se generan autom√°ticamente con datos personalizados:

```bash
npm run stories:generate:robust  # Recomendado - usa archivos .mocks.js
npm run stories:test             # Validar el generador
```

**Nuevo**: Los desarrolladores pueden crear archivos `.mocks.js` junto a sus componentes para definir datos de ejemplo espec√≠ficos del dominio, eliminando la necesidad de datos gen√©ricos.

### Generar Documentaci√≥n

```bash
# Desarrollo
npm run storybook

# Build de producci√≥n
npm run build-storybook
```

## üõ†Ô∏è Desarrollo

### Workflow de Desarrollo

1. **Crear/Modificar componente** en `src/components/`
2. **Actualizar metadata** en `component-metadata.json`
3. **Documentar** en Storybook
4. **Probar** con `npm run dev`
5. **Generar WordPress** con `npm run wp:generate`
6. **Validar** con `npm run wp:validate`

### Debugging

#### Verificar Generaci√≥n

```bash
# Generar con logs detallados
npm run wp:generate

# Verificar estructura generada
ls -la wordpress-output/toulouse-lautrec/

# Validar tema
npm run wp:validate
```

#### Logs de Errores

- **Componente no encontrado**: Verificar metadata en `component-metadata.json`
- **Error de PHP**: Revisar template en `php-components.js`
- **Assets faltantes**: Verificar build de Vite

### Testing

```bash
# Test de componentes
npm run test

# Test de generaci√≥n
npm run wp:validate

# Test de build
npm run build
```

## üì¶ Despliegue

### WordPress Local

1. **Generar tema:**
```bash
npm run wp:generate
```

2. **Copiar a WordPress:**
```bash
cp -r wordpress-output/toulouse-lautrec /path/to/wp-content/themes/
```

3. **Activar tema** en WordPress Admin

### WordPress en Producci√≥n

1. **Build de producci√≥n:**
```bash
npm run build
npm run wp:generate
```

2. **Subir archivos:**
```bash
# Subir tema completo
rsync -avz wordpress-output/toulouse-lautrec/ user@server:/var/www/html/wp-content/themes/toulouse-lautrec/
```

3. **Configurar symlinks** (opcional):
```bash
# Para desarrollo continuo
ln -s /path/to/project/wordpress-output/toulouse-lautrec /var/www/html/wp-content/themes/toulouse-lautrec
```

### CI/CD

```yaml
# .github/workflows/deploy.yml
name: Deploy WordPress Theme

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '24'
      
      - run: npm ci
      - run: npm run build
      - run: npm run wp:generate
      
      - name: Deploy to server
        uses: appleboy/ssh-action@v0.1.5
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.KEY }}
          script: |
            cd /var/www/html/wp-content/themes/
            rm -rf toulouse-lautrec
            cp -r /tmp/toulouse-lautrec .
```

## ü§ù Contribuci√≥n

### Gu√≠as de Contribuci√≥n

1. **Fork** el repositorio
2. **Crear branch** para feature: `git checkout -b feature/nuevo-componente`
3. **Desarrollar** siguiendo las convenciones
4. **Documentar** en Storybook
5. **Probar** generaci√≥n WordPress
6. **Commit** con mensaje descriptivo
7. **Push** y crear Pull Request

### Convenciones

#### Naming

- **Componentes**: `kebab-case` (`hero-section`, `course-card`)
- **Funciones PHP**: `snake_case` (`render_hero_section`)
- **Variables CSS**: `kebab-case` (`--tl-primary-500`)
- **Archivos**: `kebab-case` (`hero-section.js`)

#### Estructura de Commits

```
feat: agregar componente testimonials
fix: corregir generaci√≥n de PHP para course-card
docs: actualizar documentaci√≥n de design tokens
refactor: simplificar metadata de componentes
```

#### Code Style

- **JavaScript**: ESLint + Prettier
- **CSS**: Design tokens centralizados
- **PHP**: WordPress Coding Standards
- **JSON**: Formato consistente

## üìÑ Licencia

Este proyecto est√° bajo la licencia MIT. Ver `LICENSE` para m√°s detalles.

## üÜò Soporte

### Problemas Comunes

#### Error: "No se encontr√≥ metadata para el componente"

**Soluci√≥n**: Agregar metadata en `component-metadata.json`

#### Error: "Componente no se genera correctamente"

**Soluci√≥n**: Verificar estructura del componente Lit y metadata

#### Error: "Assets no se copian"

**Soluci√≥n**: Verificar build de Vite y permisos de directorio

### Recursos

**üìö Documentaci√≥n del Proyecto:**
- **[üÜï Gu√≠a de Mocks Personalizados](./CUSTOM_MOCKS_GUIDE.md)** - C√≥mo crear datos de ejemplo personalizados
- **[üìä Analytics Manager Guide](./ANALYTICS_MANAGER_GUIDE.md)** - **NUEVO** - Sistema de Analytics separado del SEO
- [üìö Generador de Stories](./STORIES_GENERATOR_GUIDE.md) - Sistema autom√°tico de generaci√≥n de stories  
- [üéØ Tutorial End-to-End](./TUTORIAL_END_TO_END.md) - De Lit Component a WordPress
- [üß© Gu√≠a de Extensiones](./EXTENSIONS_GUIDE.md) - Extensiones para WordPress
- [üöÄ Gu√≠a de Despliegue](./WORDPRESS-DEPLOYMENT.md) - Despliegue en WordPress

**üåê Documentaci√≥n Externa:**
- [Documentaci√≥n Lit](https://lit.dev/docs/)
- [WordPress Theme Handbook](https://developer.wordpress.org/themes/)
- [Storybook Documentation](https://storybook.js.org/docs/)
- [Design Tokens Guide](https://www.designtokens.org/)

### Contacto

- **Issues**: [GitHub Issues](https://github.com/org/toulouse-design-system/issues)
- **Discussions**: [GitHub Discussions](https://github.com/org/toulouse-design-system/discussions)
- **Email**: design-system@toulouselautrec.edu.pe

---

**Desarrollado con ‚ù§Ô∏è por el equipo de Toulouse Lautrec**
