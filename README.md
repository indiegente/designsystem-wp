# üé® Toulouse Design System

**Sistema de dise√±o moderno con generaci√≥n autom√°tica de temas WordPress de calidad profesional**

## üöÄ Caracter√≠sticas Principales

- ‚úÖ **Componentes Lit** modernos y reutilizables
- ‚úÖ **Generaci√≥n autom√°tica** de temas WordPress desde componentes
- ‚úÖ **AssetManager modernizado** - Delega optimizaci√≥n a Vite (minificaci√≥n, tree-shaking, cache-busting)
- ‚úÖ **Validaci√≥n h√≠brida profesional** - PHPCS + Lighthouse + validaciones espec√≠ficas de managers
- ‚úÖ **Fail-fast approach** - Sin fallbacks silenciosos, rollback autom√°tico completo
- ‚úÖ **WordPress Best Practices** - PHPCS integrado con WordPress Coding Standards
- ‚úÖ **Calidad garantizada** - Solo genera c√≥digo que pasa todas las validaciones
- ‚úÖ **Validaci√≥n de renderizado** - Verifica consistencia entre metadata.json y page-templates.json
- ‚úÖ **Sistema de extensiones** - Hooks personalizables para analytics y funcionalidades avanzadas

## üìã Comandos Principales

### üöÄ **Generaci√≥n de Tema**
```bash
npm run wp:generate           # Generaci√≥n completa con PHPCS y validaciones
npm run wp:generate:debug     # Generaci√≥n con logs detallados (DEBUG_MODE=true)
npm run wp:generate:fast      # Generaci√≥n r√°pida sin PHPCS (SKIP_PHPCS=true)
```

### üîß **Setup Inicial**
```bash
npm install                   # Instala dependencias (incluye Lighthouse)
npm run setup                 # Instala Composer + PHPCS WordPress Standards
npm run setup:composer        # Solo instalar Composer
npm run setup:phpcs          # Solo instalar PHPCS + WordPress Standards
```

### üß™ **Validaci√≥n y Calidad**
```bash
npm run wp:validate           # Validaci√≥n h√≠brida completa
npm run wp:validate:render    # Solo validaci√≥n de renderizado
npm run wp:test-urls          # Test URLs en WordPress vivo
npm run wp:lint               # WordPress Coding Standards (PHPCS)
npm run wp:lint:fix           # Auto-fix PHPCS
npm run phpcs                 # PHPCS directo
npm run phpcs:fix             # PHPCBF directo
```

### üìö **Desarrollo de Componentes**
```bash
npm run dev                   # Vite dev server
npm run build                 # Build para producci√≥n
npm run storybook             # Documentaci√≥n interactiva
npm run build-storybook       # Build de Storybook
```

### üß© **Storybook Stories**
```bash
npm run stories:generate      # Generar stories b√°sicas
npm run stories:generate:robust # Generar stories robustas
npm run stories:test          # Test del generador de stories
```

## üèóÔ∏è Arquitectura Modernizada

### Estructura Actual

```
toulouse-design-system/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/           # Componentes Lit
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hero-section/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ course-card/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ testimonials/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ feature-grid/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interactive-gallery/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test-showcase/
‚îÇ   ‚îú‚îÄ‚îÄ tokens/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ design-tokens.css # Variables CSS centralizadas
‚îÇ   ‚îú‚îÄ‚îÄ extensions/         # üß© Sistema de extensiones
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test-extension.js           # Extensi√≥n de prueba/validaci√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ conditional-logic-example.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ events-and-interactions-example.js
‚îÇ   ‚îú‚îÄ‚îÄ metadata.json        # Metadata de componentes + tipos
‚îÇ   ‚îú‚îÄ‚îÄ page-templates.json  # Configuraci√≥n de p√°ginas + props
‚îÇ   ‚îî‚îÄ‚îÄ index.js            # Entry point
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ generate-wp-templates.js    # Entry point principal
‚îÇ   ‚îú‚îÄ‚îÄ validation/          # üîç Sistema de validaci√≥n multinivel
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hybrid-validator.js         # Validador h√≠brido profesional
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ component-render-validator.js # Validaci√≥n renderizado componentes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ component-render-validator-cli.js # CLI standalone
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manager-validator.js        # Validaci√≥n de managers
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wordpress-url-tester.js     # Test URLs WordPress vivo
‚îÇ   ‚îî‚îÄ‚îÄ wp-generator/        # Sistema de generaci√≥n WordPress
‚îÇ       ‚îú‚îÄ‚îÄ core/            # Configuraci√≥n central
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ config.js               # Config din√°mico con fail-fast
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ config-manager.js       # Gestor de configuraci√≥n
‚îÇ       ‚îú‚îÄ‚îÄ managers/        # Gestores especializados
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ asset-manager.js        # Assets optimizados (Vite)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ analytics-manager.js    # GA4 + eventos separado
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ seo-editable-manager.js  # SEO din√°mico + ACF editable
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ component-generator.js  # Lit ‚Üí PHP + extensiones
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ template-builder.js     # Templates WordPress
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ theme-structure.js      # Estructura del tema
‚îÇ       ‚îú‚îÄ‚îÄ templates/       # Generadores de c√≥digo
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ php-components.js       # PHP components
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ functions-template.js   # functions.php
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ dynamic-page-templates.js
‚îÇ       ‚îú‚îÄ‚îÄ validation/      # Validaci√≥n PHP + sintaxis
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ validator.js            # Validador b√°sico
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ validation-manager.js   # Validaciones avanzadas
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ php-validator.js        # Validaci√≥n PHP tiempo real
‚îÇ       ‚îî‚îÄ‚îÄ extensions/      # üß© Sistema de extensiones
‚îÇ           ‚îú‚îÄ‚îÄ extension-manager.js    # Gestor de extensiones + hooks
‚îÇ           ‚îî‚îÄ‚îÄ analytics/              # Extensiones Analytics
‚îÇ               ‚îú‚îÄ‚îÄ ga4-data-layer.js
‚îÇ               ‚îú‚îÄ‚îÄ facebook-pixel.js
‚îÇ               ‚îî‚îÄ‚îÄ custom-events.js
‚îú‚îÄ‚îÄ wordpress-output/        # Tema WordPress generado (con calidad)
‚îÇ   ‚îî‚îÄ‚îÄ toulouse-lautrec/   # Tema final con estructura correcta
‚îÇ       ‚îú‚îÄ‚îÄ assets/         # Assets optimizados por Vite
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ css/       # CSS + design-tokens
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ js/        # JavaScript optimizado
‚îÇ       ‚îú‚îÄ‚îÄ components/    # Componentes PHP generados
‚îÇ       ‚îú‚îÄ‚îÄ inc/          # Archivos de inclusi√≥n
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ seo-manager.php
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ analytics-manager.php
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ asset-enqueue.php
‚îÇ       ‚îú‚îÄ‚îÄ functions.php # WordPress functions
‚îÇ       ‚îú‚îÄ‚îÄ style.css    # WordPress theme info
‚îÇ       ‚îî‚îÄ‚îÄ page-*.php   # Templates de p√°gina
‚îî‚îÄ‚îÄ composer.phar          # Auto-instalado si es necesario
```

## üîß Flujo de Generaci√≥n Completo

### `npm run wp:generate` - El Comando Definitivo

```mermaid
graph TD
    A[üöÄ Inicio] --> B[üßπ Limpiar output]
    B --> C[üìÅ Crear estructura]
    C --> D[üß© Generar componentes PHP]
    D --> E[üì¶ Optimizar assets con Vite]
    E --> F[üìÑ Generar templates WordPress]
    F --> G[üîç Generar SEO + Analytics]
    G --> H[‚úÖ Validar sintaxis PHP]
    H --> I[üîß Aplicar PHPCS auto-fix]
    I --> J[üéØ Validaci√≥n h√≠brida]
    J --> K{¬øTodo exitoso?}
    K -->|‚ùå No| L[üîÑ Rollback completo]
    K -->|‚úÖ S√≠| M[üöÄ Tema listo para producci√≥n]
    L --> N[‚ùå Error espec√≠fico + soluci√≥n]
```

### Criterios de √âxito Estrictos

- ‚úÖ **Sintaxis PHP 100% v√°lida** (php -l)
- ‚úÖ **PHPCS auto-fix exitoso** (14,000+ errores corregidos)
- ‚úÖ **Validaci√≥n h√≠brida EXCELLENT** (100% managers)
- ‚úÖ **Assets optimizados funcionando** (CSS, JS, Tokens)
- ‚úÖ **Dependencias verificadas** (Composer, Lighthouse)

## üß© Componentes Disponibles

### Componentes Principales

- **`hero-section`** - Secci√≥n hero con CTA
- **`course-card`** - Tarjetas de cursos
- **`testimonials`** - Sistema de testimonios con ratings
- **`feature-grid`** - Grid de caracter√≠sticas
- **`interactive-gallery`** - Galer√≠a interactiva
- **`test-showcase`** - Componente de prueba para validaciones

### Generaci√≥n Autom√°tica Lit ‚Üí PHP

Cada componente Lit se convierte autom√°ticamente a PHP siguiendo las reglas de WordPress:

```javascript
// Lit Component (src/components/hero-section/hero-section.js)
render() {
  return html`
    <section class="hero">
      <h1>${this.title}</h1>
      <p>${this.description}</p>
    </section>
  `;
}
```

```php
<?php
// PHP generado (wordpress-output/toulouse-lautrec/components/hero-section/hero-section.php)
function render_hero_section($title = '', $description = '') {
    ?>
    <section class="hero">
      <h1><?php echo esc_html($title); ?></h1>
      <p><?php echo esc_html($description); ?></p>
    </section>
    <?php
}
?>
```

## üß© Tipos de Componentes y Configuraci√≥n

### **1. Static Components**
> Contenido fijo definido en configuraci√≥n

```json
{
  "name": "hero-section",
  "props": {
    "title": "Bienvenidos",
    "subtitle": "Descubre tu potencial creativo",
    "ctaText": "Comenzar"
  }
}
```

### **2. Iterative Components**
> Bucles simples sobre colecciones WordPress

```json
{
  "name": "course-card",
  "dataSource": {
    "type": "post",
    "postType": "carrera",
    "query": { "numberposts": -1 },
    "mapping": {
      "title": { "source": "post_title", "type": "native" },
      "image": { "source": "post_thumbnail_url", "type": "native" }
    }
  }
}
```

### **3. Aggregated Components**
> Datos complejos con ACF, agregaci√≥n avanzada

```json
{
  "name": "testimonials",
  "dataSource": {
    "type": "post",
    "postType": "testimonio",
    "mapping": {
      "user_photo": { "source": "meta_user_photo", "type": "acf" },
      "rating": { "source": "meta_rating", "type": "acf" }
    }
  }
}
```

### **üîÑ Separaci√≥n de Responsabilidades**

- **`metadata.json`** - Define QU√â tipo de campo (`fieldType: "image"`)
- **`page-templates.json`** - Define D√ìNDE viene el dato (`source: "meta_photo"`)
- **Manejo autom√°tico de im√°genes** - Convierte IDs a URLs autom√°ticamente

## ‚öôÔ∏è Configuraci√≥n

### Archivos de Configuraci√≥n Principales

1. **`scripts/wp-generator/core/config.js`** - Configuraci√≥n central
2. **`src/metadata.json`** - Metadata de componentes
3. **`src/page-templates.json`** - Configuraci√≥n de p√°ginas

### Analytics + SEO Separados

```javascript
// config.js - Analytics separado de SEO
analytics: {
  googleAnalytics: {
    measurementId: 'G-ABC123DEF4',
    enabled: true
  },
  facebookPixel: {
    pixelId: '',
    enabled: false
  },
  customEvents: {
    pageViews: true,
    componentViews: true,
    interactions: true
  }
}
```

## üîç Sistema de Validaci√≥n H√≠brida

### Herramientas Profesionales Integradas

1. **PHPCS** - WordPress Coding Standards
2. **Lighthouse** - Performance, SEO, Accessibility
3. **Validaciones espec√≠ficas** - Managers de funcionalidad

### Validaciones en Tiempo Real

- ‚úÖ **Sintaxis PHP** - Validaci√≥n inmediata
- ‚úÖ **Estructura de archivos** - Verificaci√≥n completa
- ‚úÖ **Assets funcionando** - CSS, JS, Design Tokens
- ‚úÖ **Managers operativos** - SEO, Analytics, Templates
- ‚úÖ **URLs responsivas** - Test en WordPress vivo

## üì¶ Despliegue y Uso

### Para Desarrolladores Nuevos

```bash
# 1. Clonar e instalar
git clone <repo>
cd toulouse-design-system
npm install

# 2. Setup autom√°tico (primera vez)
npm run setup

# 3. Generar tema WordPress con calidad profesional
npm run wp:generate

# 4. El tema estar√° listo en wordpress-output/toulouse-lautrec/
```

## üîÑ **Workflow Completo: Storybook ‚Üí WordPress Deploy**

### **Paso 1: Desarrollo de Componentes**
```bash
# 1.1 Iniciar entorno de desarrollo
npm run dev                # Vite dev server (componentes Lit)
npm run storybook          # Documentaci√≥n interactiva en puerto 6006

# 1.2 Crear/editar componente
# Editar: src/components/mi-componente/mi-componente.js
# Verificar en: http://localhost:6006
```

### **Paso 2: Configurar Metadata y Templates**
```bash
# 2.1 Configurar tipo de componente en metadata.json
{
  "mi-componente": {
    "type": "aggregated",
    "arrayFields": [
      {"name": "titulo", "type": "string", "fieldType": "text"},
      {"name": "imagen", "type": "string", "fieldType": "image"}
    ]
  }
}

# 2.2 Configurar datos en page-templates.json
{
  "page-ejemplo": {
    "components": [{
      "name": "mi-componente",
      "dataSource": {
        "type": "post",
        "postType": "mi_post_type",
        "mapping": {
          "titulo": {"source": "post_title", "type": "native"},
          "imagen": {"source": "meta_imagen", "type": "acf"}
        }
      }
    }]
  }
}
```

### **Paso 3: Generar Stories (Opcional)**
```bash
npm run stories:generate         # Stories b√°sicas
npm run stories:generate:robust  # Stories con datos complejos
npm run stories:test            # Verificar generador
```

### **Paso 4: Generar Tema WordPress**
```bash
# 4.1 Generaci√≥n completa con validaciones
npm run wp:generate

# 4.2 O con opciones espec√≠ficas
npm run wp:generate:debug       # Con logs detallados
npm run wp:generate:fast        # Sin PHPCS (desarrollo r√°pido)
```

### **Paso 5: Validar Calidad**
```bash
# 5.1 Validaci√≥n h√≠brida completa
npm run wp:validate

# 5.2 Validaciones espec√≠ficas
npm run wp:validate:render      # Solo renderizado
npm run wp:lint                 # Solo PHPCS
npm run wp:test-urls           # URLs WordPress
```

### **Paso 6: Deploy en WordPress**
```bash
# 6.1 Copiar tema generado
cp -r wordpress-output/toulouse-lautrec /path/to/wordpress/wp-content/themes/

# 6.2 Activar en WordPress Admin
# Ve a: Apariencia > Temas > Activar "Toulouse Lautrec"

# 6.3 Verificar custom post types y ACF fields
# Se auto-crean seg√∫n configuraci√≥n en metadata.json
```

### **Paso 7: Testing en WordPress**
```bash
# 7.1 URLs disponibles tras activaci√≥n:
# /carreras/        - Lista componentes course-card
# /contacto/        - P√°gina est√°tica
# /test-showcase/   - Validaci√≥n completa

# 7.2 Verificar datos din√°micos
# Crear posts del tipo configurado en wp-admin
# Los componentes mostrar√°n datos reales autom√°ticamente
```

### **üîÑ Para Desarrollo Continuo**
```bash
# Ciclo iterativo de desarrollo:
1. npm run dev              # Modificar componentes
2. npm run wp:generate      # Regenerar tema
3. Refresh WordPress        # Ver cambios en vivo
4. npm run wp:test-urls     # Validar URLs espec√≠ficas
```

### **üêõ Troubleshooting para Developers**

**‚ùå Error: "fieldTypes is not defined"**
```bash
# Soluci√≥n: Verificar metadata.json tiene arrayFields definidos
# Regenerar con debug para ver logs
npm run wp:generate:debug
```

**‚ùå Error: "src="45" en lugar de URL de imagen"**
```bash
# Soluci√≥n: Campo image debe tener fieldType: "image" en metadata.json
# El sistema auto-convierte IDs a URLs
```

**‚ùå Error: "Componente no renderiza datos"**
```bash
# 1. Verificar names exactos entre Lit y page-templates.json
# 2. Verificar dataSource mapping correcto
# 3. Usar validaci√≥n de renderizado:
npm run wp:validate:render
```

**‚ùå Error: "PHPCS fallando"**
```bash
# Auto-fix disponible:
npm run wp:lint:fix
# O skip para desarrollo r√°pido:
npm run wp:generate:fast
```

### **üí° Tips para Developers**

**üöÄ Desarrollo R√°pido:**
```bash
# Skip validaciones para iteraci√≥n r√°pida
npm run wp:generate:fast

# Solo regenerar un componente espec√≠fico
# (editar src/page-templates.json para incluir solo ese componente)
```

**üîç Debug Avanzado:**
```bash
# Logs detallados de generaci√≥n
DEBUG_MODE=true npm run wp:generate

# Ver estructura generada
ls -la wordpress-output/toulouse-lautrec/

# Verificar sintaxis PHP individual
php -l wordpress-output/toulouse-lautrec/components/mi-componente/mi-componente.php
```

**üìã Validaci√≥n Granular:**
```bash
# Solo validar managers espec√≠ficos
npm run wp:validate

# Solo validar URLs espec√≠ficas
npm run wp:test-urls

# Solo validar renderizado
npm run wp:validate:render
```

## üéØ WordPress Best Practices

### Seguridad y Escapado
- ‚úÖ `esc_html()` para texto
- ‚úÖ `esc_url()` para URLs
- ‚úÖ `esc_attr()` para atributos
- ‚úÖ `wp_kses_post()` para contenido rico

### Internacionalizaci√≥n
- ‚úÖ `__()` y `_e()` para todos los textos
- ‚úÖ Text domain consistente
- ‚úÖ Sin strings hardcodeados

## üöÄ WordPress Deployment

### **Instalaci√≥n del Tema**

1. **Copia el tema generado:**
   ```bash
   cp -r wordpress-output/toulouse-lautrec /path/to/wordpress/wp-content/themes/
   ```

2. **Activa el tema en WordPress Admin:**
   - Ve a `Apariencia > Temas`
   - Activa "Toulouse Lautrec"

### **Configuraci√≥n de Custom Post Types**

El tema incluye ACF fields autom√°ticamente. Para usar los custom post types:

```php
// Se auto-registran: carrera, testimonio
// ACF fields se auto-crean seg√∫n metadata.json
```

### **URLs de Prueba**

Una vez instalado, estas p√°ginas estar√°n disponibles:
- `/carreras/` - Lista de carreras con course-cards
- `/contacto/` - P√°gina de contacto
- `/test-showcase/` - Validaci√≥n de todos los managers

### Estructura WordPress
- ‚úÖ `get_template_part()` en lugar de `require`
- ‚úÖ `wp_enqueue_script()` y `wp_enqueue_style()`
- ‚úÖ Hooks y filtros apropiados
- ‚úÖ Nonce de seguridad para formularios

## üõ†Ô∏è Troubleshooting

### Errores Comunes

**‚ùå Composer no encontrado**
```bash
npm run setup:composer
```

**‚ùå Lighthouse faltante**
```bash
npm install  # Ya incluido en devDependencies
```

**‚ùå PHPCS errores**
```bash
npm run wp:lint:fix  # Auto-correcci√≥n
```

### Estados de Error vs √âxito

- **‚úÖ √âXITO**: Solo si TODO funciona (fail-fast)
- **‚ùå ERROR**: Cualquier dependencia faltante o proceso fallido
- **üîÑ ROLLBACK**: Limpieza autom√°tica completa

## üìö Documentaci√≥n Adicional

- **[CLAUDE.md](CLAUDE.md)** - Instrucciones espec√≠ficas para Claude
- **[TUTORIAL_END_TO_END.md](TUTORIAL_END_TO_END.md)** - Tutorial completo
- **[WORDPRESS-DEPLOYMENT.md](WORDPRESS-DEPLOYMENT.md)** - Despliegue WordPress

## üèÜ Estado del Proyecto

**‚úÖ PRODUCCI√ìN-READY**
- Generaci√≥n completamente automatizada
- Calidad profesional garantizada
- Validaciones estrictas integradas
- Dependencias auto-gestionadas
- Rollback autom√°tico en errores
- WordPress Coding Standards aplicados

---

**üéØ Un solo comando. Calidad profesional garantizada.**

`npm run wp:generate`